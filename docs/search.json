[{"content":"We will implement RSTP in a small topology to observe its rapid convergence.\nTopology Root bridge Election We know that root selection is based on lowest Bridge ID value consisting of:\n Switch MAC address (6 bytes). Bridge Priority (2 bytes): 32786 + Sys-ext-id (basically the VLAN number).  Sw1 is now started and we monitor its link e0/0 toward SW2 then we enable RSTP.\n1  SW1(config)#spanning-tree mode rapid-pvst    Note:\nRSTP can be single or multiple instances. In Cisco implementation, Cisco used RSTP as an underlying mechanism for its rapid-pvst which supports RSTP instance per each VLAN.\nAlso RSTP is used as part of 802.1s MST\n Capturing an STP frame sent by SW1 we notice the following:\n This is the well-known STP multicast address that switches running STP listen to. Here we see the version ID 2 which indicate RSTP, this is sent inside the BPDU and is used to differentiate switches running RSTP from switches running the legacy STP (version 0). Those are the flags used by RSTP inside the BPDU to indicate the port role and state, it also used when topology change happens. Also they’re used in synchronization process by using proposal and agreement flags. This is the root bridge ID. It’s SW1 because other switches are turned off right now. This is the local bridge ID (SW1) Those are STP timers, which are set by the root bridge.   STP timers refresher:\nHello timer: is the time interval between Configuration BPDUs sent by the root bridge. Forward Delay timer: is the time interval that a switch port spends in both Listening and Learning states.\nMax Age timer: is how long a switch stores a BPDU before it’s aged out, and if no BPDUs received during the Max Age timer the switch will know that a topology change occurred.\nThis will tell you that if a topology change occurred the convergence time is more than 2x Forward Delay timer.\n Now, I know that SW1 was added first to eve-ng topology so I know it’s going to be the root because it has the lowest MAC address. Regardless let’s start SW3 and configure it to use RSTP.\nWe can verify who’s the root bridge by:\n1  SW1#show spanning-tree   Notice that SW1 is the root bridge and that all its ports have the designated role with the state of forwarding.\nAs soon as SW3 sees SW1 BPDUs it knows it’s not the root bridge (SW1 has lower MAC address) but we can observe in the following capture that when RSTP was first enabled on SW3 it sent BPDU declaring itself as the root and proposed that its port should take the designated role.\nSW1 did not agree on that so the role of SW3 port changed to root port.\nSwitch: RSTP activated! I’m gonna sync now So as a switch I know who’s the root bridge and which of my ports is the root port and the cost toward it. But now because I’m a good switch I’m going to find out what are the roles of my other ports.\nThat’s what is called Synchronization\n RSTP Port Roles Refresher:\nRoot port: has the best cost to the root bridge.\nDesignated port: port on a network segment that has the best root path cost to the root bridge.\nAlternate port: port that has an alternate path to the root bridge. but less desirable. If root port is down this port becomes the root port and will move to forwarding state immediately\nBackup port: a less desirable port connected to a segment where another port is already connected.\n Let’s introduce SW2 to the topology and enable RSTP on it.\nSW2 will receive a superior BPDU directly from the root bridge (SW1), so SW3 will put all its nonedge ports in discarding states to prevent loops and the root port is moved to forwarding state immediately.\n RSTP Ports Types Refresher:\nEdge: single host is connected to the port.\nRoot: port with best path cost to root bridge.\nPoint-to-Point: a port connecting to another switch.\n Now for each nonedge port SW2 will send a proposal to its neighbor (SW3) and it will receive an agreement (SW2 has a lower bridge ID than SW3) and the port will be moved to forwarding state immediately.\nBy doing a packet capture on SW2 e0/1 port we can see its proposal to SW3 declaring its port should be the designated port:\nHere’s SW3 sending an agreement to SW2:\nSo we see that the entire convergence process is happening at the speed of BPDU transmission and all the switches will propagate these handshakes (Proposal \u0026 Agreement) on all point-to-point links and using synchronization to prevent loops while the network is converging.\nLet’s guess SW4 Let’s power-on SW4 and try to guess its ports role and state before we enable RSTP and verify:\n SW4 has a higher bridge ID (its MAC address is higher) than SW1 and it’s directly connected to the root bridge. SW4 has a higher bridge ID than SW2. All ports in this topology has the same speed thus the same STP cost.  So based on that, SW4 ports role and states are:\n e0/0: root, forwarding. It has a lower port ID than e0/1 e0/1: alternate, discarding. e0/2: alternate, discarding.   Note: Discarding state is indicated as BLK in show spanning-tree command in Cisco IOS.\n Verification All verifications are the output of show spanning-tree on all switches.\nSW1: SW2: SW3: SW4: Final State And happy convergence everyone !\n","description":"","tags":["Cisco","Layer 2","STP"],"title":"RSTP: I’m the Root. That’s my Proposal !","uri":"/neve/posts/layer2/rstp/"},{"content":"I’m Ghaith Baddour and I’m a Network Engineer with 5+ years of experience. I’m Cisco certified CCNP Enterprise as well as SD-WAN Specialist (ENSDWI).\nI started this project, Network Engineer Virtual Experience - NEVE, in 17-March-2021 with the purpose of demonstrating my experience in Cisco and networking technologies using projects done in virtualization platforms: EVE-NG and VMware.\nWhy?\nIt’s rare to find engineers that have been lucky to work in real life with all the technologies they know or study. So why not presenting their knowledge by implementing virtual projects of real-life scenarios.\nAlso, this can be used as a portfolio for network engineers to demonstrate their understanding of the technology and how it can be beneficial/applicable in real-life scenarios.\n","description":"","tags":null,"title":"About","uri":"/neve/about/"}]
